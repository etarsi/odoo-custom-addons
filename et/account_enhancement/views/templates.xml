<odoo>
    <data>

        <!-- Template raíz: llama al original con t-call -->
        <template id="report_payment_group_document2">
            <t t-call="account_payment_group.report_payment_group_document">
                <!-- Definimos correctamente 'o' -->
                <t t-set="o" t-value="docs[0].with_context(lang=lang)"/>

                <!-- 1) Setear variables personalizadas -->
                <t t-set="custom_header" t-value="'l10n_ar.custom_header'"/>
                <t t-set="report_date" t-value="o.payment_date"/>
                <t t-set="document_letter" t-value="'X'"/>
                <t t-set="document_legend" t-value="'Doc. no válido como factura'"/>
                <t t-set="report_number" t-value="o.document_number"/>
                <t t-set="report_name" t-value="o.partner_type == 'supplier' and 'Orden de pago' or 'Recibo'"/>
                <t t-set="header_address" t-value="o.receiptbook_id.report_partner_id or o.company_id.partner_id"/>

                <t t-set="custom_footer">
                    <div class="row">
                        <div name="footer_left_column" class="col-8">
                            <t t-if="not o.company_id.l10n_ar_report_signature">
                                Observaciones: <span t-field="o.notes"/>
                            </t>
                        </div>
                        <div name="footer_right_column" class="col-4">
                            <t t-if="not o.company_id.l10n_ar_report_signature">
                                <span class="text-center">Firma y Aclaración</span>
                            </t>
                            <div class="text-right" name="pager" t-if="report_type == 'pdf'">
                                Page: <span class="page"/> / <span class="topage"/>
                            </div>
                        </div>
                    </div>
                </t>

                <!-- ############################### -->
                <!--   BLOQUE - INFORMACIÓN CLIENTE -->
                <!-- ############################### -->

                <xpath expr="//div[@id='informations']" position="inside">
                    <div class="col-6">
                        <strong>
                            <span t-out="o.partner_type == 'supplier' and 'Proveedor: ' or 'Cliente: '"/>
                        </strong>
                        <span t-field="o.partner_id.commercial_partner_id.name"/>

                        <br/>
                        <span t-out="o.partner_id"
                              t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;], &quot;no_marker&quot;: True, &quot;no_tag_br&quot;: True}"/>

                        <strong>VAT Cond: </strong>
                        <span t-field="o.partner_id.l10n_ar_afip_responsibility_type_id"/>

                        <t t-if="o.partner_id.vat and o.partner_id.l10n_latam_identification_type_id.name and o.partner_id.l10n_latam_identification_type_id.name != 'Sigd'">
                            <br/>
                            <strong>
                                <t t-out="o.partner_id.l10n_latam_identification_type_id.name or o.company_id.country_id.vat_label" id="inv_tax_id_label"/>
                                :
                            </strong>
                            <span t-out="o.partner_id.l10n_ar_formatted_vat or o.partner_id.vat"/>
                        </t>
                    </div>
                </xpath>


                <!-- ############################### -->
                <!--   TABLA DE PAGOS CON ÍNDICE     -->
                <!-- ############################### -->

                <xpath expr="//div[@id='informations']" position="after">
                    <br/>
                    <table class="table table-sm o_main_table" name="payments_table">
                        <thead>
                            <tr>
                                <th><span>Índice</span></th>
                                <th><span>Pagos</span></th>
                                <th class="text-right" t-if="any(o.mapped('payment_ids.other_currency'))">
                                    <span>Importe divisa</span>
                                </th>
                                <th class="text-right"><span>Importe</span></th>
                            </tr>
                        </thead>
                        <tbody>

                            <!-- Cheques -->
                            <t t-foreach="o.payment_ids
                                            .filtered(lambda x: x.payment_method_code in ['check_printing','new_third_party_checks','in_third_party_checks','out_third_party_checks'])
                                            .sorted(key=lambda r:r.l10n_latam_check_payment_date or r.date)"
                               t-as="line" t-foreach-index="i">

                                <t t-set="check" t-value="line.l10n_latam_check_id or line"/>
                                <tr>
                                    <td><t t-esc="i + 1"/></td> <!-- ÍNDICE -->
                                    <td>
                                        <span t-out="&quot;Cheque %s nro %s - %s&quot; % (
                                            &quot;electrónico &quot; if check.l10n_latam_checkbook_id.type == &quot;electronic&quot; else &quot;&quot;,
                                            check.check_number,
                                            check.l10n_latam_check_bank_id.name or check.journal_id.name)"/>
                                        <span t-if="check.l10n_latam_check_payment_date">
                                            - Venc. <span t-field="check.l10n_latam_check_payment_date"/>
                                        </span>
                                    </td>
                                    <td class="text-right" t-if="any(o.mapped('payment_ids.other_currency'))">
                                        <t t-if="check.currency_id">
                                            <span class="text-nowrap"
                                                  t-field="check.amount_signed"
                                                  t-field-options="{&quot;widget&quot;: &quot;monetary&quot;,  &quot;display_currency&quot;: &quot;check.currency_id&quot;}"/>
                                        </t>
                                    </td>
                                    <td class="text-right o_price_total">
                                        <span class="text-nowrap" t-field="check.l10n_ar_amount_company_currency_signed"/>
                                    </td>
                                </tr>

                            </t>

                            <!-- Retenciones -->
                            <t t-foreach="o.payment_ids.filtered(lambda x: x.tax_withholding_id)" t-as="line">
                                <tr>
                                    <td><span>-</span></td>  <!-- sin índice -->
                                    <td><span t-out="&quot;%s - %s&quot; % (line.tax_withholding_id.name, line.withholding_number or line.name)"/></td>
                                    <td class="text-right" t-if="any(o.mapped('payment_ids.other_currency'))">
                                        <t t-if="line.other_currency">
                                            <span class="text-nowrap"
                                                  t-field="line.amount_signed"
                                                  t-field-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: &quot;line.currency_id&quot;}"/>
                                        </t>
                                    </td>
                                    <td class="text-right o_price_total">
                                        <span class="text-nowrap" t-field="line.l10n_ar_amount_company_currency_signed"/>
                                    </td>
                                </tr>
                            </t>

                            <!-- Otros pagos -->
                            <t t-foreach="o.payment_ids.filtered(lambda x: not x.tax_withholding_id and x.payment_method_code not in ['check_printing','new_third_party_checks','in_third_party_checks','out_third_party_checks'])"
                               t-as="line">
                                <tr>
                                    <td><span>-</span></td>  <!-- sin índice -->
                                    <td><span t-field="line.journal_id.name"/></td>
                                    <td class="text-right" t-if="any(o.mapped('payment_ids.other_currency'))">
                                        <t t-if="line.other_currency">
                                            <span class="text-nowrap"
                                                  t-field="line.amount_signed"
                                                  t-field-options="{&quot;widget&quot;: &quot;monetary&quot;,  &quot;display_currency&quot;: &quot;line.currency_id&quot;}"/>
                                        </t>
                                    </td>
                                    <td class="text-right o_price_total">
                                        <span class="text-nowrap" t-field="line.l10n_ar_amount_company_currency_signed"/>
                                    </td>
                                </tr>
                            </t>

                        </tbody>
                    </table>
                </xpath>

                <!-- resto de bloques… se mantienen igual -->

            </t>
        </template>

    </data>
</odoo>
