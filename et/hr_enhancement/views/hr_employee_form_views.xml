<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_hr_employee_form_inherit" model="ir.ui.view">
        <field name="name">hr.employee.form.inherit</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">
            <!-- 1. Insertar statusbar debajo del título -->
            <xpath expr="//div[@class='oe_title']" position="after">
                <field name="state" widget="statusbar" statusbar_visible="draft,confirmed"/>
            </xpath>
            <!-- 2. Botón para solicitar edición (visible solo en estado 'confirmed') -->
            <xpath expr="//header" position="inside">
                <button name="action_request_edit"
                        string="Solicitar Edición"
                        type="object"
                        attrs="{'invisible': [('state', '!=', 'confirmed')]}"
                        class="btn-primary"/>
                <button name="action_confirm"
                        string="Confirmar"
                        type="object"
                        attrs="{'invisible': [('state', '!=', 'draft')]}"
                        class="btn-success"/>
            </xpath>
            <!-- 3. Nueva pestaña de solicitudes de edición -->
            <xpath expr="//notebook" position="inside">
                <page string="Solicitudes de Edición">
                    <field name="edit_request_ids">
                        <tree>
                            <field name="create_date"/>
                            <field name="reason"/>
                            <field name="approved_user_id"/>
                            <field name="state"/>
                        </tree>
                        <form>
                            <field name="reason"/>
                            <field name="notes"/>
                            <field name="state"/>
                        </form>
                    </field>
                </page>
            </xpath>
            <!-- Hacer todo el contenido de <sheet> readonly si está confirmado -->
            <xpath expr="//sheet" position="attributes">
                <attribute name="attrs">{'readonly': [('state','=','confirmado')]}</attribute>
            </xpath>
            <xpath expr="//page[@name='hr_settings']" position="attributes">
                <attribute name="attrs">{'invisible': [('id', '!=', 0)]}</attribute>
            </xpath>
            <xpath expr="//page[@name='personal_information']" position="replace">
                <page name="information_private" string="Información Privada">
                    <group string="Legajo Personal">
                        <group string="Contacto Privado">
                            <field name="email_personal" string="Email" widget="email"/>
                            <field name="phone" class="o_force_ltr" groups="hr.group_hr_user" string="Teléfono"/>
                            <field name="celular" string="Celular"/>
                            <field name="location_id" string="Dirección"/>
                        </group>
                        <group string="Ciudadanía">
                            <field name="country_id" options="{&quot;no_open&quot;: True, &quot;no_create&quot;: True}" attrs="{'required': True}"/>
                            <field name="dni" groups="hr.group_hr_user"/>
                            <field name="cuil" groups="hr.group_hr_user"/>
                            <field name="gender" attrs="{'required': True}"/>
                            <field name="birthday" attrs="{'required': True}"/>
                            <field name="place_of_birth" groups="hr.group_hr_user" attrs="{'required': True}"/>
                            <field name="country_of_birth" groups="hr.group_hr_user" attrs="{'required': True}"/>
                            <field name="identification_id" groups="hr.group_hr_user"/>
                            <field name="passport_id" groups="hr.group_hr_user"/>
                        </group>
                        <group string="Estado Civil">
                            <field name="marital" attrs="{'required': True}"/>
                            <field name="spouse_complete_name" attrs="{'invisible': [('marital', 'not in', ['married', 'cohabitant'])],
                                                                        'required': [('marital', 'in', ['married', 'cohabitant'])]}"/>
                            <field name="spouse_dni" attrs="{'invisible': [('marital', 'not in', ['married', 'cohabitant'])],
                                                                 'required': [('marital', 'in', ['married', 'cohabitant'])]}"/>
                        </group>
                        <group string="Dependientes">
                            <field name="is_children"/>
                            <field name="children_ids" widget="one2many_list" attrs="{'invisible': [('is_children', '=', False)], 'required': [('is_children', '=', True)]}"/>
                        </group>
                        <group string="Emergencia">
                            <field name="emergency_contact"/>
                            <field name="emergency_phone" class="o_force_ltr"/>
                        </group>
                        <group string="Datos Bancarios" name="bank_details">
                            <field name="bank"/>
                            <field name="nro_account"/>
                            <field name="cbu"/>
                            <field name="alias"/>
                        </group>
                        <group string="Educación">
                            <field name="certificate"/>
                            <field name="study_field"/>
                            <field name="study_school"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
