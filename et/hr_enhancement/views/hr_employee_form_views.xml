<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Agregar wizard de empleado -->
    <record id="view_hr_employee_offboard_wizard_form" model="ir.ui.view">
        <field name="name">hr.employee.offboard.wizard.form</field>
        <field name="model">hr.employee.offboard.wizard</field>
        <field name="arch" type="xml">
        <form string="Dar de Baja Empleado" create="false" edit="false">
            <group>
                <field name="employee_id" options="{'no_create': True}" required="1" readonly="1"/>
                <field name="date" required="1"/>
                <field name="reason" required="1"/>
                <field name="description" placeholder="Detalle u observaciones..."/>
            </group>
            <footer>
                <button string="Confirmar" type="object" name="action_confirm" class="btn-primary"/>
                <button string="Cancelar" special="cancel" class="btn-secondary"/>
            </footer>
        </form>
        </field>
    </record>

    <!-- Acción del wizard (modal) -->
    <record id="action_hr_employee_offboard_wizard" model="ir.actions.act_window">
        <field name="name">Dar de Baja Empleado</field>
        <field name="res_model">hr.employee.offboard.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_hr_employee_offboard_wizard_form"/>
        <field name="target">new</field>
        <!-- default_employee_id se toma del empleado actual -->
        <field name="context">{'default_employee_id': active_id}</field>
    </record>

    <record id="view_hr_employee_form_inherit" model="ir.ui.view">
        <field name="name">hr.employee.form.inherit</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">
            <!-- 2. Botón para solicitar edición (visible solo en estado 'confirmed') -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button
                    type="object"
                    name="action_view_my_salary_adjustments"
                    class="oe_stat_button"
                    icon="fa-money"
                    groups="hr_enhancement.group_hr_administrador">
                    <div class="o_stat_info">
                        <span class="o_stat_text">Salario Actual</span>
                        <span class="o_stat_value">
                            <field name="wage"/>
                        </span>
                    </div>
                </button>
                <button
                    type="object"
                    name="action_view_my_licenses"
                    class="oe_stat_button"
                    icon="fa-certificate">
                    <div class="o_stat_info">
                        <span class="o_stat_text">Licencias</span>
                        <span class="o_stat_value">
                            <field name="license_count"/>
                        </span>
                    </div>
                </button>
                <!-- Botón para mostrar el estado del empleado -->
                <button
                    type="object"
                    name="show_employee_state"
                    class="oe_stat_button"
                    icon="fa-info-circle">
                    <div class="o_stat_info">
                        <span class="o_stat_text">Estado:</span>
                        <span class="o_stat_value">
                            <field name="state" readonly="1"/>
                        </span>
                    </div>
                </button>
                <!-- Botón para mostrar el tipo de empleado -->
                <button
                    type="object"
                    name="show_employee_type"
                    class="oe_stat_button"
                    icon="fa-user">
                    <div class="o_stat_info">
                        <span class="o_stat_value">
                            <field name="employee_type" widget="selection" readonly="1"/>
                        </span>
                    </div>
                </button>
            </xpath>
            <xpath expr="//header" position="inside">
                <button name="action_request_edit"
                        string="Solicitar Edición"
                        type="object"
                        attrs="{'invisible': [('state', '!=', 'active')]}"
                        class="btn-primary"/>
                <button name="action_confirm"
                        string="Confirmar"
                        type="object"
                        attrs="{'invisible': [('state', '!=', 'draft')]}"
                        class="btn-success"/>
                <button name="action_set_active"
                        string="Dar de Alta"
                        type="object"
                        attrs="{'invisible': [('state', '!=', 'confirmed')]}"
                        groups="hr_enhancement.group_hr_administrador"
                        class="btn-info"/>
                <button type="action"
                        name="%(action_hr_employee_offboard_wizard)d"
                        groups="hr_enhancement.group_hr_administrador"
                        string="Dar de Baja"
                        class="btn-danger"
                        attrs="{'invisible': [('active', '=', False)]}"/>
            </xpath>
            <xpath expr="//field[@name='image_1920']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//page[@name='hr_settings']" position="attributes">
                <attribute name="attrs">{'invisible': [('id', '!=', 0)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='job_title']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='category_ids']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='mobile_phone']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='work_phone']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='work_email']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='department_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='parent_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='coach_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='address_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='work_location_id']" position="replace">
            </xpath>
            <xpath expr="//field[@name='departure_reason_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='departure_description']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='departure_date']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='resource_calendar_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='tz']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='departure_reason_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')]}</attribute>
            </xpath>
            <xpath expr="//page[@name='personal_information']" position="replace">
                <page name="information_private" string="Información Privada">
                    <group string="Legajo Personal">
                        <group string="Contacto Privado">
                            <field name="state" invisible="1"/>
                            <field name="email_personal" string="Email" widget="email" attrs="{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}"/>
                            <field name="phone" class="o_force_ltr" groups="hr.group_hr_user" string="Teléfono" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="celular" string="Celular" attrs="{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}"/>
                            <field name="location_id" string="Dirección" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        </group>
                        <group string="Ciudadanía">
                            <field name="country_id" options="{&quot;no_open&quot;: True, &quot;no_create&quot;: True}" attrs="{'required': [('employee_type', '=', 'employee')] }"/>
                            <field name="dni" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="cuil" attrs="{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}"/>
                            <field name="gender" attrs="{'required': [('employee_type', '=', 'employee')], 'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="birthday" attrs="{'required': [('employee_type', '=', 'employee')], 'readonly': [('state', '!=', 'draft')] }"/>
                            <field name="place_of_birth" attrs="{'required': [('employee_type', '=', 'employee')], 'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="country_of_birth" attrs="{'required': [('employee_type', '=', 'employee')], 'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="identification_id" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="passport_id" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        </group>
                        <group string="Estado Civil">
                            <field name="marital" attrs="{'required': [('state', '=', 'draft'), ('employee_type', '=', 'employee')], 'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="spouse_complete_name" attrs="{'invisible': [('marital', 'not in', ['married', 'cohabitant'])],
                                                                        'required': [('marital', 'in', ['married', 'cohabitant'])],
                                                                        'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="spouse_dni" attrs="{'invisible': [('marital', 'not in', ['married', 'cohabitant'])],
                                                                'required': [('marital', 'in', ['married', 'cohabitant'])],
                                                                'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="is_children" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        </group>
                        <group string="Emergencia">
                            <field name="emergency_contact" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="emergency_phone" class="o_force_ltr" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        </group>
                        <group string="Datos Bancarios" name="bank_details">
                            <field name="bank" attrs="{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}"/>
                            <field name="nro_account" attrs="{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}"/>
                            <field name="cbu" attrs="{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}"/>
                            <field name="alias" attrs="{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}"/>
                        </group>
                        <group string="Educación">
                            <field name="certificate" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="study_field" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="study_school" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        </group>
                        <group string="Documentación">
                            <field name="dni_photo_front" 
                                attrs="{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]} "
                                widget="image" 
                                options="{'preview_image': 'dni_front', 'size': [100, 150]}"/>
                                
                            <field name="dni_photo_back" 
                                attrs="{'readonly': [('state', '!=', 'draft')], 'required': [('employee_type', '=', 'employee')]}"
                                widget="image" 
                                options="{'preview_image': 'dni_back', 'size': [100, 150]}"/>
                        </group>
                    </group>
                </page>
                <page string="Historial Salarial" groups="hr_enhancement.group_hr_administrador" name="salary_history">
                    <field name="salary_ids">
                        <tree create="false" delete="false" edit="false">
                            <field name="date"/>
                            <field name="real_salary"/>
                            <field name="gross_salary"/>
                            <field name="bank_salary"/>
                            <field name="percentage_increase"/>
                            <field name="tipo_ajuste"/>
                            <field name="notes"/>
                            <field name="state" widget="badge" decoration-info="state == 'draft'" 
                                decoration-warning="state == 'expired'"
                                decoration-success="state == 'confirmed'" 
                                decoration-danger="state == 'cancelled'"/>
                        </tree>
                    </field>
                </page>
                <page name="information_internal" string="Informacion Interna" groups="hr_enhancement.group_hr_administrador">
                    <group>
                        <field name="employee_type" widget="selection" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        <field name="wage" readonly="1"/>
                        <field name="total_percentage_increase" readonly="1" widget="percentage"/>
                        <fields name="type_shift" widget="radio" 
                            options="{'horizontal': true}" 
                            attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                    </group>
                </page>
                <page name="dependiente" string="Dependientes" attrs="{'invisible': [('is_children', '=', False)]}">
                    <group>
                        <field name="children_ids" widget="one2many_list" 
                            attrs="{'required': [('is_children', '=', True)],
                                    'readonly': [('state', '!=', 'draft'), ('employee_type', '=', 'employee')]}" />
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Agregar filtros -->
    <record id="hr_employee_search_inherit_custom" model="ir.ui.view">
        <field name="name">hr.employee.search.custom</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">

                <!-- Nuevo filtro por correo corporativo -->
                <filter string="Empleados" name="filter_employee_types"
                        domain="[('employee_type', '=', 'employee')]"/>

                <filter string="Eventuales" name="filter_eventual_types"
                        domain="[('employee_type', '=', 'eventual')]"/>

                <filter string="Bajas" name="filter_state_bajas"
                        domain="[('state', '=', 'inactive')]"/>

                <!-- Nuevo filtro por empleados activos -->
                <filter string="Activos" name="filter_employee_active"
                        domain="[('state', '=', 'active')]"/>

                <!-- Separador visual -->
                <separator/>

                <!-- Nuevo Agrupar por -->
                <group expand="0" string="Agrupar por">
                    <filter string="Tipo de Empleado" name="group_employee_type" context="{'group_by': 'employee_type'}"/>
                    <filter string="Estado" name="group_state" context="{'group_by': 'state'}"/>
                </group>

            </xpath>
        </field>
    </record>


    <!-- Vista tree del historial -->
    <record id="view_hr_employee_offboard_tree" model="ir.ui.view">
        <field name="name">hr.employee.offboard.tree</field>
        <field name="model">hr.employee.offboard</field>
        <field name="arch" type="xml">
        <tree>
            <field name="date"/>
            <field name="reason"/>
            <field name="description"/>
            <field name="user_id"/>
        </tree>
        </field>
    </record>

    <!-- Vista form simple del historial (opcional) -->
    <record id="view_hr_employee_offboard_form" model="ir.ui.view">
        <field name="name">hr.employee.offboard.form</field>
        <field name="model">hr.employee.offboard</field>
        <field name="arch" type="xml">
        <form string="Baja de Empleado">
            <group>
                <field name="employee_id" readonly="1"/>
                <field name="date" readonly="1"/>
                <field name="reason" readonly="1"/>
                <field name="description" readonly="1"/>
                <field name="user_id" readonly="1"/>
            </group>
            <footer>
                <button string="Cerrar" class="btn-secondary" special="cancel"/>
            </footer>
        </form>
        </field>
    </record>

    <!-- Acción para abrir el historial filtrado por empleado -->
    <record id="action_hr_employee_offboard_history" model="ir.actions.act_window">
        <field name="name">Historial de Bajas</field>
        <field name="res_model">hr.employee.offboard</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('employee_id', '=', active_id)]</field>
        <field name="context">{'default_employee_id': active_id}</field>
    </record>

    <!-- Smart button en ficha de empleado para ver historial -->
    <record id="view_hr_employee_form_inherit_offboard_smart" model="ir.ui.view">
        <field name="name">hr.employee.form.inherit.offboard.smart</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">
        <xpath expr="//div[@name='button_box']" position="inside">
            <button class="oe_stat_button"
                    type="action"
                    name="%(action_hr_employee_offboard_history)d"
                    icon="fa-user-times">
            <div class="o_stat_info">
                <span class="o_stat_text">Bajas</span>
            </div>
            </button>
        </xpath>
        </field>
    </record>
</odoo>